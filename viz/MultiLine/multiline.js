var data = [{"date":20111001,"New York":63.4,"San Francisco":62.7,"Austin":72.2},
{"date":20111002,"New York":58.0,"San Francisco":59.9,"Austin":67.7},
{"date":20111003,"New York":53.3,"San Francisco":59.1,"Austin":69.4},
{"date":20111003,"New York":53.3,"San Francisco":59.1,"Austin":69.4},
{"date":20111004,"New York":55.7,"San Francisco":58.8,"Austin":68.0},
{"date":20111005,"New York":64.2,"San Francisco":58.7,"Austin":72.4},
{"date":20111006,"New York":58.8,"San Francisco":57.0,"Austin":77.0},
{"date":20111007,"New York":57.9,"San Francisco":56.7,"Austin":82.3},
{"date":20111008,"New York":61.8,"San Francisco":56.8,"Austin":78.9},
{"date":20111009,"New York":69.3,"San Francisco":56.7,"Austin":68.8},
{"date":20111010,"New York":71.2,"San Francisco":60.1,"Austin":68.7},
{"date":20111011,"New York":68.7,"San Francisco":61.1,"Austin":70.3},
{"date":20111012,"New York":61.8,"San Francisco":61.5,"Austin":75.3},
{"date":20111013,"New York":63.0,"San Francisco":64.3,"Austin":76.6},     
{"date":20111014,"New York":66.9,"San Francisco":67.1,"Austin":66.6},
{"date":20111015,"New York":61.7,"San Francisco":64.6,"Austin":68.0},
{"date":20111016,"New York":61.8,"San Francisco":61.6,"Austin":70.6},
{"date":20111017,"New York":62.8,"San Francisco":61.1,"Austin":71.1},
{"date":20111018,"New York":60.8,"San Francisco":59.2,"Austin":70.0},
{"date":20111019,"New York":62.1,"San Francisco":58.9,"Austin":61.6},
{"date":20111020,"New York":65.1,"San Francisco":57.2,"Austin":57.4},
{"date":20111021,"New York":55.6,"San Francisco":56.4,"Austin":64.3},
{"date":20111022,"New York":54.4,"San Francisco":60.7,"Austin":72.4},
{"date":20111023,"New York":54.4,"San Francisco":65.1,"Austin":72.4},
{"date":20111024,"New York":54.8,"San Francisco":60.9,"Austin":72.5},
{"date":20111025,"New York":57.9,"San Francisco":56.1,"Austin":72.7},
{"date":20111026,"New York":54.6,"San Francisco":54.6,"Austin":73.4},
{"date":20111027,"New York":54.4,"San Francisco":56.1,"Austin":70.7},
{"date":20111028,"New York":42.5,"San Francisco":58.1,"Austin":56.8},
{"date":20111029,"New York":40.9,"San Francisco":57.5,"Austin":51.0},
{"date":20111030,"New York":38.6,"San Francisco":57.7,"Austin":54.9},
{"date":20111031,"New York":44.2,"San Francisco":55.1,"Austin":58.8},
{"date":20111101,"New York":49.6,"San Francisco":57.9,"Austin":62.6},
{"date":20111102,"New York":47.2,"San Francisco":64.6,"Austin":71.0},
{"date":20111103,"New York":50.1,"San Francisco":56.2,"Austin":58.4},
{"date":20111104,"New York":50.1,"San Francisco":50.5,"Austin":45.1},
{"date":20111105,"New York":43.5,"San Francisco":51.3,"Austin":52.2},
{"date":20111106,"New York":43.8,"San Francisco":52.6,"Austin":73.0},
{"date":20111107,"New York":48.9,"San Francisco":51.4,"Austin":75.4},
{"date":20111108,"New York":55.5,"San Francisco":50.6,"Austin":72.1},
{"date":20111109,"New York":53.7,"San Francisco":54.6,"Austin":56.6},
{"date":20111110,"New York":57.7,"San Francisco":55.6,"Austin":55.4},
{"date":20111111,"New York":48.5,"San Francisco":53.9,"Austin":46.7},
{"date":20111112,"New York":46.8,"San Francisco":54.0,"Austin":62.0},
{"date":20111113,"New York":51.1,"San Francisco":53.8,"Austin":71.6},
{"date":20111114,"New York":56.8,"San Francisco":53.5,"Austin":75.5},
{"date":20111115,"New York":59.7,"San Francisco":53.4,"Austin":72.1},
{"date":20111116,"New York":56.5,"San Francisco":52.2,"Austin":65.7},
{"date":20111117,"New York":49.6,"San Francisco":52.7,"Austin":56.8},
{"date":20111118,"New York":41.5,"San Francisco":53.1,"Austin":49.9},
{"date":20111119,"New York":44.3,"San Francisco":49.0,"Austin":71.7},
{"date":20111120,"New York":54.0,"San Francisco":50.4,"Austin":77.7},
{"date":20111121,"New York":54.1,"San Francisco":51.1,"Austin":76.4}];
{"date":20111122,"New York":49.4,"San Francisco":52.3,"Austin":68.8},
{"date":20111123,"New York":50.0,"San Francisco":54.6,"Austin":57.0},
{"date":20111124,"New York":44.0,"San Francisco":55.1,"Austin":55.5},
{"date":20111125,"New York":50.3,"San Francisco":51.5,"Austin":61.6},
{"date":20111126,"New York":52.1,"San Francisco":53.6,"Austin":64.1},
{"date":20111127,"New York":49.6,"San Francisco":52.3,"Austin":51.1},
{"date":20111128,"New York":57.2,"San Francisco":51.0,"Austin":43.0},
{"date":20111129,"New York":59.1,"San Francisco":49.5,"Austin":46.4},
{"date":20111130,"New York":50.6,"San Francisco":49.8,"Austin":48.0},
{"date":20111201,"New York":44.3,"San Francisco":60.4,"Austin":48.1},
{"date":20111202,"New York":43.9,"San Francisco":62.2,"Austin":60.6},
{"date":20111203,"New York":42.1,"San Francisco":58.3,"Austin":62.6},
{"date":20111204,"New York":43.9,"San Francisco":52.7,"Austin":57.1},
{"date":20111205,"New York":50.2,"San Francisco":51.5,"Austin":44.2},
{"date":20111206,"New York":54.2,"San Francisco":49.9,"Austin":37.4},
{"date":20111207,"New York":54.6,"San Francisco":48.6,"Austin":35.0},
{"date":20111208,"New York":43.4,"San Francisco":46.4,"Austin":37.0},
{"date":20111209,"New York":42.2,"San Francisco":49.8,"Austin":45.4},
{"date":20111210,"New York":45.0,"San Francisco":52.1,"Austin":50.7},
{"date":20111211,"New York":33.8,"San Francisco":48.8,"Austin":48.6},
{"date":20111212,"New York":36.8,"San Francisco":47.4,"Austin":52.2},
{"date":20111213,"New York":38.6,"San Francisco":47.2,"Austin":60.8},
/*{"date":20111214,"New York":41.9,"San Francisco":46.1,"Austin":70.0},
{"date":20111215,"New York":49.6,"San Francisco":48.8,"Austin":64.2},
{"date":20111216,"New York":50.2,"San Francisco":47.9,"Austin":50.9},
{"date":20111217,"New York":40.6,"San Francisco":49.8,"Austin":51.6},
{"date":20111218,"New York":29.1,"San Francisco":49.1,"Austin":55.2},
{"date":20111219,"New York":33.7,"San Francisco":48.3,"Austin":62.1},
{"date":20111220,"New York":45.8,"San Francisco":49.3,"Austin":56.3},
{"date":20111221,"New York":47.4,"San Francisco":48.4,"Austin":47.2},
{"date":20111222,"New York":54.4,"San Francisco":53.3,"Austin":52.3},
{"date":20111223,"New York":47.8,"San Francisco":47.5,"Austin":45.2},
{"date":20111224,"New York":34.9,"San Francisco":47.9,"Austin":43.6},
{"date":20111225,"New York":35.9,"San Francisco":48.9,"Austin":42.9},
{"date":20111226,"New York":43.6,"San Francisco":45.9,"Austin":48.2},
{"date":20111227,"New York":42.9,"San Francisco":47.2,"Austin":45.4},
{"date":20111228,"New York":46.2,"San Francisco":48.9,"Austin":44.2},
{"date":20111229,"New York":30.8,"San Francisco":50.9,"Austin":50.4},
{"date":20111230,"New York":40.8,"San Francisco":52.9,"Austin":52.4},
{"date":20111231,"New York":49.8,"San Francisco":50.1,"Austin":53.5},
{"date":20120101,"New York":46.3,"San Francisco":53.9,"Austin":55.9},
{"date":20120102,"New York":43.2,"San Francisco":53.1,"Austin":48.2},
{"date":20120103,"New York":30.3,"San Francisco":49.7,"Austin":41.0},
{"date":20120104,"New York":19.2,"San Francisco":52.7,"Austin":48.9},
{"date":20120105,"New York":32.1,"San Francisco":52.6,"Austin":54.8},
{"date":20120106,"New York":41.2,"San Francisco":49.0,"Austin":61.2},
{"date":20120107,"New York":47.0,"San Francisco":51.0,"Austin":59.7},
{"date":20120108,"New York":46.0,"San Francisco":56.8,"Austin":52.5},
{"date":20120109,"New York":34.7,"San Francisco":52.3,"Austin":54.0},
{"date":20120110,"New York":39.4,"San Francisco":51.6,"Austin":47.7},
{"date":20120111,"New York":40.4,"San Francisco":49.8,"Austin":49.2},
{"date":20120112,"New York":45.4,"San Francisco":51.9,"Austin":48.4},
{"date":20120113,"New York":40.7,"San Francisco":53.7,"Austin":40.2},
{"date":20120114,"New York":30.4,"San Francisco":52.9,"Austin":43.9},
{"date":20120115,"New York":23.9,"San Francisco":49.7,"Austin":45.2},
{"date":20120116,"New York":22.6,"San Francisco":45.3,"Austin":65.0},
{"date":20120117,"New York":39.8,"San Francisco":43.6,"Austin":68.2},
{"date":20120118,"New York":43.2,"San Francisco":45.0,"Austin":47.5},
{"date":20120119,"New York":26.3,"San Francisco":47.3,"Austin":57.1},
{"date":20120120,"New York":32.8,"San Francisco":51.4,"Austin":61.9},
{"date":20120121,"New York":27.4,"San Francisco":53.7,"Austin":54.6},
{"date":20120122,"New York":25.0,"San Francisco":48.3,"Austin":56.7},
{"date":20120123,"New York":39.4,"San Francisco":52.9,"Austin":54.4},
{"date":20120124,"New York":48.7,"San Francisco":49.1,"Austin":52.7},
{"date":20120125,"New York":43.0,"San Francisco":52.1,"Austin":61.8},
{"date":20120126,"New York":37.1,"San Francisco":53.6,"Austin":55.0},
{"date":20120127,"New York":48.2,"San Francisco":50.4,"Austin":50.7},
{"date":20120128,"New York":43.7,"San Francisco":50.3,"Austin":52.9},
{"date":20120129,"New York":40.1,"San Francisco":53.8,"Austin":44.4},
{"date":20120130,"New York":38.0,"San Francisco":51.9,"Austin":49.1},
{"date":20120131,"New York":43.5,"San Francisco":50.0,"Austin":62.8},
{"date":20120201,"New York":50.4,"San Francisco":50.0,"Austin":64.6},
{"date":20120202,"New York":45.8,"San Francisco":51.3,"Austin":61.1},
{"date":20120203,"New York":37.5,"San Francisco":51.5,"Austin":70.0},
{"date":20120204,"New York":40.8,"San Francisco":52.0,"Austin":61.3},
{"date":20120205,"New York":36.5,"San Francisco":53.8,"Austin":48.2},
{"date":20120206,"New York":39.1,"San Francisco":54.6,"Austin":44.2},
{"date":20120207,"New York":43.2,"San Francisco":54.3,"Austin":51.3},
{"date":20120208,"New York":36.5,"San Francisco":51.9,"Austin":49.2},
{"date":20120209,"New York":36.5,"San Francisco":53.8,"Austin":45.7},
{"date":20120210,"New York":38.3,"San Francisco":53.9,"Austin":54.1},
{"date":20120211,"New York":36.9,"San Francisco":52.3,"Austin":44.9},
{"date":20120212,"New York":29.7,"San Francisco":50.1,"Austin":36.5},
{"date":20120213,"New York":33.1,"San Francisco":49.5,"Austin":44.8},
{"date":20120214,"New York":39.6,"San Francisco":48.6,"Austin":52.3},
{"date":20120215,"New York":42.3,"San Francisco":49.9,"Austin":68.0},
{"date":20120216,"New York":39.7,"San Francisco":52.4,"Austin":54.6},
{"date":20120217,"New York":46.0,"San Francisco":49.9,"Austin":53.8},
{"date":20120218,"New York":41.2,"San Francisco":51.6,"Austin":56.2},
{"date":20120219,"New York":39.8,"San Francisco":47.8,"Austin":50.8},
{"date":20120220,"New York":38.1,"San Francisco":48.7,"Austin":53.0},
{"date":20120221,"New York":37.1,"San Francisco":49.7,"Austin":61.0},
{"date":20120222,"New York":45.5,"San Francisco":53.4,"Austin":68.8},
{"date":20120223,"New York":50.6,"San Francisco":54.1,"Austin":69.4},
{"date":20120224,"New York":42.7,"San Francisco":55.9,"Austin":59.3},
{"date":20120225,"New York":42.6,"San Francisco":51.7,"Austin":47.2},
{"date":20120226,"New York":36.9,"San Francisco":47.7,"Austin":47.7},
{"date":20120227,"New York":40.9,"San Francisco":45.4,"Austin":61.9},
{"date":20120228,"New York":45.9,"San Francisco":47.0,"Austin":67.2},
{"date":20120229,"New York":40.7,"San Francisco":49.8,"Austin":70.1},
{"date":20120301,"New York":41.3,"San Francisco":48.9,"Austin":62.1},
{"date":20120302,"New York":36.8,"San Francisco":48.1,"Austin":72.7},
{"date":20120303,"New York":47.6,"San Francisco":50.7,"Austin":59.0},
{"date":20120304,"New York":44.2,"San Francisco":55.0,"Austin":51.8},
{"date":20120305,"New York":38.5,"San Francisco":48.8,"Austin":55.0},
{"date":20120306,"New York":32.9,"San Francisco":48.4,"Austin":61.8},
{"date":20120307,"New York":43.3,"San Francisco":49.9,"Austin":67.1},
{"date":20120308,"New York":51.2,"San Francisco":49.2,"Austin":72.0},
{"date":20120309,"New York":47.8,"San Francisco":51.7,"Austin":46.4},
{"date":20120310,"New York":37.2,"San Francisco":49.3,"Austin":46.7},
{"date":20120311,"New York":42.9,"San Francisco":50.0,"Austin":56.9},
{"date":20120312,"New York":48.8,"San Francisco":48.6,"Austin":61.9},
{"date":20120313,"New York":52.6,"San Francisco":53.9,"Austin":68.8},
{"date":20120314,"New York":60.5,"San Francisco":55.2,"Austin":71.9},
{"date":20120315,"New York":47.2,"San Francisco":55.9,"Austin":72.0},
{"date":20120316,"New York":44.7,"San Francisco":54.6,"Austin":72.5},
{"date":20120317,"New York":48.2,"San Francisco":48.2,"Austin":71.7},
{"date":20120318,"New York":48.2,"San Francisco":47.1,"Austin":71.1},
{"date":20120319,"New York":53.1,"San Francisco":45.8,"Austin":73.0},
{"date":20120320,"New York":57.8,"San Francisco":49.7,"Austin":63.8},
{"date":20120321,"New York":57.5,"San Francisco":51.4,"Austin":60.0},
{"date":20120322,"New York":57.3,"San Francisco":51.4,"Austin":62.3},
{"date":20120323,"New York":61.7,"San Francisco":48.4,"Austin":61.1},
{"date":20120324,"New York":55.8,"San Francisco":49.0,"Austin":62.0},
{"date":20120325,"New York":48.4,"San Francisco":46.4,"Austin":64.6},
{"date":20120326,"New York":49.8,"San Francisco":49.7,"Austin":66.0},
{"date":20120327,"New York":39.6,"San Francisco":54.1,"Austin":65.8},
{"date":20120328,"New York":49.7,"San Francisco":54.6,"Austin":69.2},
{"date":20120329,"New York":56.8,"San Francisco":52.3,"Austin":69.5},
{"date":20120330,"New York":46.5,"San Francisco":54.5,"Austin":73.5},
{"date":20120331,"New York":42.2,"San Francisco":56.2,"Austin":73.9}];*/


var margin = {top: 20, right: 80, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var parseDate = d3.time.format("%Y%m%d").parse;

  data.forEach(function(d) {
    d.date = parseDate(new String(d.date));
  });

var x = d3.time.scale()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var color = d3.scale.category10();

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .interpolate("basis")
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.temperature); });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

 
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

  var cities = color.domain().map(function(name) {
    return {
      name: name,
      values: data.map(function(d) {
        return {date: d.date, temperature: +d[name]};
      })
    };
  });

  x.domain(d3.extent(data, function(d) { return d.date; }));

  y.domain([
    d3.min(cities, function(c) { return d3.min(c.values, function(v) { return v.temperature; }); }),
    d3.max(cities, function(c) { return d3.max(c.values, function(v) { return v.temperature; }); })
  ]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Temperature (ºF)");

console.log(cities);

  var city = svg.selectAll(".city")
      .data(cities)
    .enter().append("g")
      .attr("class", "city");

  city.append("svg:path")
      .attr("class", "line")
      .attr("d",function(d){return line(d.values);})
      .on("mouseover", function() {
          d3.select(this).style("stroke-opacity",1)})
          .style("stroke", function(d) {return color(d.name);
      })
      .on("click", function(){
      d3.select(this).style("stroke-width",5);
      })
      .on("mouseout", function() {
          d3.select(this).style("stroke-opacity",0.5)
          //d3.select(this).style("stroke-width",5)
 });

  city.append("text")
      .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
      .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.temperature) + ")"; })
      .attr("x", 3)
      .attr("dy", ".35em")
      .text(function(d) { return d.name; });

svg.append("svg:rect")
.attr("x",x(x.domain()[0])+2)
.attr("y",y(y.domain()[1])-5)
.attr("height",y(y.domain()[0]))
.attr("width",x(x.domain()[1]))
.style("fill","#fff")
.transition().duration(5000).attr("x",x(x.domain()[1]))